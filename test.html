
CREATE OR REPLACE function fn_transfer_data(p_year IN NUMBER, origin_table IN VARCHAR2, destination_table IN VARCHAR2) AS
    CREATE TABLE temp_table AS 
            SELECT * FROM origin_table;  
        -- добавляем новый столбец
        ALTER TABLE temp_table
        ADD YEAR NUMBER;
        -- Заполняем столбец 'year' во временной таблице
        UPDATE temp_table SET year = p_year;
        -- Перенос данных из временной таблицы в целевую
        INSERT INTO destination_table
        SELECT * FROM temp_table;
        DROP TABLE temp_table;
        COMMIT;
        -- DELETE FROM ACTH_INT_FNS_list_CUSTOM
    exception
        WHEN OTHERS THEN
            ROLLBACK;
            EXECUTE IMMEDIATE 'DROP TABLE temp_table';
        RAISE;



CREATE OR REPLACE procedure transfer_data(p_year IN NUMBER) AS
begin
    fn_transfer_data(2022, 'ACTB_INT_FNS_list_CUSTOM', 'ACTH_INT_FNS_list_CUSTOM__TEST')
    fn_transfer_data(2022, 'ACTB_INT_FNS_RES_CUSTOM', 'ACTH_INT_FNS_RES_CUSTOM__TEST')

END;

-- ACTH_INT_FNS_list_CUSTOM__TEST - временная таблица для тестирования процедур
-- ACTH_INT_FNS_RES_CUSTOM__TEST - временная таблица для тестирования процедур























--------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- old version

CREATE OR REPLACE procedure transfer_data(p_year IN NUMBER) AS
    -- Переменная для хранения данных
    -- v_error_flag boolean := FALSE;
begin
    -- Создаем временную таблицу для хранения данных
    CREATE TABLE temp_table AS 
        SELECT * FROM ACTB_INT_FNS_list_CUSTOM;  
    -- добавляем новый столбец
    ALTER TABLE temp_table
    ADD YEAR NUMBER;
    -- Заполняем столбец 'year' во временной таблице
    UPDATE temp_table SET year = p_year;
    -- Перенос данных из временной таблицы в целевую
    INSERT INTO ACTH_INT_FNS_list_CUSTOM__TEST
    SELECT * FROM temp_table;
    DROP TABLE temp_table;
    COMMIT;
    -- DELETE FROM ACTH_INT_FNS_list_CUSTOM
exception
    WHEN OTHERS THEN
        ROLLBACK;
        EXECUTE IMMEDIATE 'DROP TABLE temp_table';
        RAISE;

END;


drop procedure transfer_data;
