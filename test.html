#!/bin/bash

arguments=$(paste -s -d ' ' ./Installers/${1}/install.txt)
echo "arguments: ${arguments}"
text="select dependency from table(fccucb.check_restart_adapters.fn_find_need_reload_obj('$arguments'));"
echo $text > check.txt
cat ./check.txt
#echo exit | sqlplus fcjucb/fcjucb@bravo17.imb.ru:21580/FCJ02.IMB.RU @check.txt > result.txt
#echo exit | sqlplus \$fcj_login/\$fcj_pass@\$fcj_db | grep Connected > /dev/null
#echo exit | sqlplus $DB_CREDENTIALS_USR[$LAST_SCHEMA]/$DB_CREDENTIALS_PSW@$DB_SERVER | grep Connected > /dev/null
echo exit | sqlplus fcc/FCC@jul0d.IMB.RU:21567/FCC10.IMB.RU @check.txt > result.txt
cat ./result.txt

if [[ $arguments == "*RESTART_ADAPTER=*" ]]; then
  echo "В файле install.txt указана необходимость перезагрузки адаптеров, дополнительной проверки не требуется"
  goto finish_checking
else
  if grep -q "NO NEED TO REBOOT ANY ADAPTERS" result.txt; then
    echo "Перезагрузка адаптеров не требуется"
  else
    echo "Требуется перезагрузка адаптеров"
    exit 1
fi

echo "Значение переменно NEED_TO_RELOAD: $NEED_TO_RELOAD"

:finish_checking
echo "Проверка завершена"
