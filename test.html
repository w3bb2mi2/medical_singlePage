FUNCTION fn_get_ins_premium (v_account_number varchar2) return cashflow_tab_type pipelined AS
  v_cashfow_row cashflow_row_type;
  v_value_date date;
BEGIN
  select value_date
    into v_value_date
  from fcc.CLTB_ACCOUNT_APPS_MASTER
  where account_number=v_account_number;
   dbms_OUTPUT.put_line(v_value_date);

  SELECT v_value_date as from_date, 
         INS_PREMIUM as emi_amount
  into v_cashfow_row
  FROM SIEBEL.SX_O_CPI_LAST_PAY@SBLREP.IMB.RU where CREDIT_NUM = v_account_number;

  DBMS_OUTPUT.PUT_LINE('' || v_cashfow_row.value_date)

  If  v_cashfow_row.emi_amount is not null then  
    pipe row(v_cashfow_row);
  ELSE 
    SELECT v_value_date as from_date, 
         0 as emi_amount
    into v_cashfow_row
    from dual;
    pipe row(v_cashfow_row);
  end if;
EXCEPTION
  WHEN others THEN
  dbms_OUTPUT.put_line('Произошла ошибка в функции: fn_get_ins_premium');
  SELECT v_value_date as from_date, 
         0 as emi_amount
  into v_cashfow_row
  from dual;
  pipe row(v_cashfow_row);
END fn_get_ins_premium;
