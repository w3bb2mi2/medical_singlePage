#!/bin/bash

arguments=$(paste -s -d ' ' ./Installers/$BRANCH_NAME/install.txt)
if [[ $arguments =~ RESTART_ADAPTER= ]]; then
  echo 'В install.txt указана необходимость перезагрузки адаптеров, дополнительной проверки не требуется'
  exit
fi

export NLS_LANG=AMERICAN_AMERICA.AL32UTF8
text="select dependency from table(fccucb.check_restart_adapters.fn_find_need_reload_obj('$arguments'));"
echo exit | sqlplus $DB_CREDENTIALS_USR['fccucb']/$DB_CREDENTIALS_PSW@$DB_SERVER <<< $text > result.txt
cat result.txt
if  cat result.txt | grep -q "Перезагрузка не требуется"; then
  exit 0
fi

echo 'Необходима перезагрузка адаптеров'
exit 1
